<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SquawkAI - Local LLM Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg: #121212;
            --surface: #1e1e1e;
            --text: #e0e0e0;
            --text-secondary: #aaaaaa;
            --accent: #FF1744;
            --highlight: #FBFF00;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .topbar {
            padding: 16px 20px;
            background: var(--surface);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }
        .left-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-shrink: 0;
        }
        .logo {
            height: 70px;
            width: auto;
        }
        .title {
            font-size: 1.6rem;
            font-weight: 300;
            color: var(--text);
            margin: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }
        select {
            padding: 10px 14px;
            border-radius: 8px;
            background: #2d2d2d;
            color: var(--text);
            border: 1px solid #444;
            font-size: 1rem;
            min-width: 180px;
        }
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
        }
        .user {
            align-self: flex-end;
            background: var(--accent);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .ai {
            align-self: flex-start;
            background: var(--surface);
            border: 1px solid #333;
            color: var(--text);
        }
        .ai pre {
            background: #0d0d0d;
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .input-area {
            padding: 15px 20px;
            background: var(--surface);
            display: flex;
            gap: 10px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
        }
        #input {
            flex: 1;
            padding: 14px;
            border-radius: 30px;
            background: #2d2d2d;
            color: var(--text);
            border: 1px solid #444;
            font-size: 1rem;
        }
        button {
            padding: 14px 24px;
            border-radius: 30px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #f5003d;
        }
        .loading {
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .topbar {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 16px;
                gap: 12px;
            }
            .left-section {
                flex-direction: column;
                gap: 12px;
            }
            .logo {
                height: 60px;
            }
            select {
                width: 100%;
                max-width: 300px;
                min-width: unset;
            }
            .title {
                font-size: 1.4rem;
                order: -1; /* Move title to top */
            }
        }
    </style>
</head>
<body>
    <div class="topbar">
        <h1 class="title">SquawkAI LLM Chat</h1>
        
        <div class="left-section">
            <!-- SquawkAI logo -->
            <svg class="logo" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
              <rect width="400" height="400" fill="#121212" fill-opacity="0"/>
              <path d="M280 180 L310 160 L300 200 Z" fill="#FF1744"/>
              <path d="M280 180 L320 190 L305 200 Z" fill="#FF1744"/>
              <path d="M200 320 C150 320 100 280 100 220 C100 160 140 120 180 110 L200 100 L220 110 C260 120 300 160 300 220 C300 280 250 320 200 320 Z" fill="#121212" stroke="#FBFF00" stroke-width="16"/>
              <circle cx="220" cy="160" r="20" fill="#FFFFFF"/>
              <circle cx="225" cy="155" r="8" fill="#121212"/>
            </svg>
            
            <select id="model">
                {% for m in models %}
                <option value="{{ m }}">{{ m | replace('-', ' ') | title }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div><!-- Spacer --></div>
    </div>

    <div id="chat-container"></div>

    <div class="input-area">
        <input id="input" type="text" placeholder="Type your message...">
        <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Send</button>
    </div>

    <script>
        let messages = [];
        const chatContainer = document.getElementById('chat-container');
        const input = document.getElementById('input');
        const modelSelect = document.getElementById('model');

        function appendMessage(role, content, isStreaming = false) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            if (role === 'ai') {
                div.innerHTML = marked.parse(content);
            } else {
                div.textContent = content;
            }
            if (isStreaming) div.classList.add('loading');
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return div;
        }

        async function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;
            input.value = '';

            appendMessage('user', msg);
            messages.push({ role: 'user', content: msg });

            const aiDiv = appendMessage('ai', 'Thinking...', true);

            const response = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ model: modelSelect.value, messages })
            });

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let aiContent = '';

            aiDiv.classList.remove('loading');
            aiDiv.innerHTML = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                const text = decoder.decode(value);
                aiContent += text;
                aiDiv.innerHTML = marked.parse(aiContent);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            messages.push({ role: 'assistant', content: aiContent });
        }

        input.addEventListener('keyup', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
